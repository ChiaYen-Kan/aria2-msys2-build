From a42e18fc1727d0c1f3ef4479046e59e6ebe6758d Mon Sep 17 00:00:00 2001
From: ChiaYen Kan <kcygamil@gmail.com>
Date: Wed, 2 Aug 2023 11:58:39 +0800
Subject: [PATCH] fix libssh2 static link error in msys2

---
 configure.ac | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/configure.ac b/configure.ac
index 1e16dd92..9b7e3227 100644
--- a/configure.ac
+++ b/configure.ac
@@ -498,6 +498,14 @@ if test "x$with_libssh2" = "xyes"; then
   PKG_CHECK_MODULES([LIBSSH2], [libssh2], [have_libssh2=yes], [have_libssh2=no])
   if test "x$have_libssh2" = "xyes"; then
     AC_DEFINE([HAVE_LIBSSH2], [1], [Define to 1 if you have libssh2.])
+
+    if test "x$ARIA2_STATIC" = "xyes"; then
+      case "$host" in
+        *mingw*)
+          LIBSSH2_CFLAGS="$LIBSSH2_CFLAGS -DLIBSSH2_API="
+        ;;
+      esac
+    fi
   else
     AC_MSG_WARN([$LIBSSH2_PKG_ERRORS])
     if test "x$with_libssh2_requested" = "xyes"; then
-- 
2.30.0.windows.2

